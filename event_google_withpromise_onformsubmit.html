<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #map {
        height: 50%;
        width:50%;
      }
      
    </style>
  </head>
<body>
  <div id="map"></div>

  <form id="userInputs">
      city:<input id="city"  type="text" name="" ><br>
      category:<input id="category"  type="text" name=""><br>
      when:<input id="when"  type="text" name=""><br>
<<<<<<< HEAD
      <button type="submit">submit</button>
  </form>

=======
      state:<input id="state"  type="text" name=""><br>
      <button type="submit">submit</button>
  </form>

  <div id="#stateoptionid"></div>

>>>>>>> b479917... Updated javascript and html
  <script   src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>

  <script type="text/javascript" src="http://api.eventful.com/js/api"></script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDE8fwiCz_eMdxWJ7B9q1uDW6Vqy8n1xGg"></script>


<<<<<<< HEAD
=======

>>>>>>> b479917... Updated javascript and html
  <script>

var eventArr=[];
var city;
var category;
// parameter object to be passed to eventful API
var oArgs = {

  app_key: "3sqmmtWF3swnsGxH",
  where: city, 
<<<<<<< HEAD
  when: "Future",   
=======
  date: "",   
>>>>>>> b479917... Updated javascript and html
  cagtegory: category,
  page_size: 5,
  sort_order: "popularity"

};
<<<<<<< HEAD
var p1, p2;
=======
var p1, p2, p3;
>>>>>>> b479917... Updated javascript and html


$(document).ready(function(){
  
  $('#userInputs').on('submit',getEventsAndPinn);


  // get events from eventful API and pin them on the map using Google API
  function getEventsAndPinn(event){
    event.preventDefault();
    console.log("inside getEventsAndPinn");

    city= $('#city').val().trim();
<<<<<<< HEAD
=======
    state = $('#stateoptionid').val();
>>>>>>> b479917... Updated javascript and html
    category= $('#category').val().trim();
    when= $('#when').val().trim();


    oArgs.where=city;
    oArgs.category = category;
    if(when){
      oArgs.when = when;
    }
              

    p1 = getEvents("/events/search", oArgs);
    p2 = initialiseGoogleMap(document.getElementById('map'),{
        zoom: 8,
        center: {lat: -34.397, lng: 150.644}
      });
<<<<<<< HEAD
=======
    // p3 = gettingWeather(city);
>>>>>>> b479917... Updated javascript and html



    p1.then(pushEventsToArray)
<<<<<<< HEAD
      .then(geocodeEvents,function(err){ console.log("error")});

=======
      .then(geocodeEvents,function(err){ console.log("error")
      // .then(gettingWeather)
    });
    
>>>>>>> b479917... Updated javascript and html
  }



  function initialiseGoogleMap(divID,mapParamObj){


      return new Promise(function(resolve,reject){
        var map = new google.maps.Map(divID,mapParamObj);
        var geocoder = new google.maps.Geocoder();

        if (map && geocoder){
          resolve({map:map,geocoder:geocoder});
        }else {reject ("error");}

      });
  }

  function pushEventsToArray(data){
    data.events.event.forEach(function(ele){
      eventArr.push({eventName : ele.title,
                      eventDate: ele.start_time,
                      venue: ele.venue_name,
                      latitude: ele.latitude,
                      longitude: ele.longitude,
<<<<<<< HEAD
                      eventAddress: ele.venue_address+', '+ele.postal_code});

=======
                      eventAddress: ele.venue_address+', '+ele.postal_code,
                      weather: p3

                      });
      console.log(eventArr);
>>>>>>> b479917... Updated javascript and html

    });

    return p2;
  }

  function getEvents(url,paramObj){


    return new Promise(function(resolve,reject){

          EVDB.API.call(url, paramObj, function(oData) {
            
              if(oData){
               resolve(oData);
             }else reject("error");

           });


      });
  }

  function geocodeEvents(data){
    eventArr.forEach(function(ele){
            console.log(ele);
          data.geocoder.geocode({'address': ele.eventAddress}, function(results, status) {
                if (status === 'OK') {
                    data.map.setCenter(results[0].geometry.location);
<<<<<<< HEAD
                    var contentString ='<div>'+ele.eventAddress+'<br>'+ele.eventDate+'</div>';

=======
                    var contentString ='<div>'+ele.eventAddress+'<br>'+ele.eventDate+p3+'</div>';
                    console.log(contentString);
>>>>>>> b479917... Updated javascript and html
                    var infowindow = new google.maps.InfoWindow({
                      content: contentString
                    });
                    var marker = new google.maps.Marker({
                      map: data.map,
                      position: results[0].geometry.location
                    });

                    marker.addListener('click', function() {
                      infowindow.open(map, marker);
                    });

                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
      });
    }


});
<<<<<<< HEAD
      
=======




function gettingWeather(city) {

    // This is our API Key
    var APIKey = "166a433c57516f51dfab1f7edaed8413";

    // Here we are building the URL we need to query the database
    var queryURL = "http://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=imperial&appid=" + '166a433c57516f51dfab1f7edaed8413';

    // Here we run our AJAX call to the OpenWeatherMap API
    $.ajax({
        url: queryURL, 
        method: 'GET'
      })

    // We store all of the retrieved data inside of an object called "response"
    .done(function(response) {

      // return new Promise(function(resolve,reject){
        

      //   if (response){
      //     resolve(response);
      //   }else {reject ("error");}

      // });

      console.log('response', response);
      console.log(response.main.temp);
});  

}  

>>>>>>> b479917... Updated javascript and html
    
    </script>
    
  </body>
</html>