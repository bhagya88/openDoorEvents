<!DOCTYPE html>
<html>
<head>
  <title></title>

  <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #map {
        height: 100%;
      }
      
    </style>
</head>
<body>



Javascript Sample page <br>


<script type="text/javascript" src="http://api.eventful.com/js/api">

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDE8fwiCz_eMdxWJ7B9q1uDW6Vqy8n1xGg&callback=initMap"
    async defer></script>

<script type="text/javascript">


var eventArr=[];

// parameter object to be passed to eventful API
var oArgs = {

  app_key: "3sqmmtWF3swnsGxH",
  where: "Austin",    
  page_size: 5,
  sort_order: "popularity"

};

function pushEventsToArray(data){
   data.events.event.forEach(function(ele){
      eventArr.push({eventName : ele.title,
                      eventDate: ele.start_time,
                      venue: ele.venue_name,
                      latitude: ele.latitude,
                      longitude: ele.longitude,
                      eventAdress: ele.venue_address+', '+ele.postal_code});


});


}

function getEvents(url,paramObj){


  return new Promise(function(resolve,reject){

        EVDB.API.call(url, paramObj, function(oData) {
          
            if(oData){
             resolve(oData);
           }else reject("error");

         });


});
}


var p = getEvents("/events/search", oArgs);



p.then(pushEventsToArray,function(err){ console.log("error")});


  function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8,
          center: {lat: -34.397, lng: 150.644}
        });
        var geocoder = new google.maps.Geocoder();

        
        geocodeAddress(geocoder, map);
        
      }

cosole.log("Event Arry", eventArr);

        function geocodeAddress(geocoder, resultsMap) {

            eventArr.forEach(function(ele){
        
            geocoder.geocode({'address': ele.eventAddress}, function(results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);
                    var contentString ='<div>'+ele.eventAddress+'<br>'+ele.eventDate+'</div>';

                    var infowindow = new google.maps.InfoWindow({
                      content: contentString
                    });
                    var marker = new google.maps.Marker({
                      map: resultsMap,
                      position: results[0].geometry.location
                    });

                    marker.addListener('click', function() {
                      infowindow.open(map, marker);
                    });

                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
      });
    }
 

</script>




</body>

</html>


